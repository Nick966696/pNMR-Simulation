[Back to Overview](README.md)

# Description of Physics
????
The setup contains the following part:
* A magnetic field which should be measured using the NMR Probe. This field is called the [Background Magnetic Field](#background_field).
* The NMR probe itself is made out of a [probe sample](#probe) made out of some proton rich [material](#materials) surrounded by a [probe coil](#coil_field) which is used to apply [RF pulses](#rf_pulse) and [pickup the induced signal](#FreeInductionDecay) in the probe sample.

We use the effect of spin precession, which introduces a makroscopic measurable changing in magnetization. The changing magnetization induces an electromotive force and thus a signal in a pickup coil. Spin precession happens when the spins are not aligned with the external magnetic field. To initially get the spins out of their equalibrium state, which is aligned with the external magnetic field, an RF pulse is applied to the probe coil. In general RF pulses can be used to change the orientation of the spins.

![alt text][NMR_Probe_Sketch_Side] **Sketch of NMR Probe** <a name="Sketch_Probe_Sideview"></a>


1. [Background Magnetic Field](#background_field)
2. [Coil Magnetic Field](#coil_field)
3. [Probe Sample](#probe)
4. [Materials and Properties](#materials)
5. [Pulsed NMR sequences](#sequence)
6. [Bloch Equations](#bloch_eq)
7. [RF Pulse](#rf_pulse)
8. [Free Induction Decay](#FreeInductionDecay)
9. [Spin Echo](#spin_echo)
10. [Noise](#noise)
11. [Signal Artefacts](#artefacts)


## Background Magnetic Field <a name="background_field"></a>

The background magnetic field is the field which should be measured by the NMR probe. In this package its called external or background field to distinguish it from the magnetic field generated by the probe coil.

The background magnetic field has to fulfill Maxwell's equations. As the background magnetic field does not have any currents in the region of interest, the background magnetic field can be described by a magnetic potential which has to fulfill the Laplace equation.
A general solution of the Laplace equation are the spherical harmonics. Spherical harmonics are an ortonormal set of equations. Thus the background magnetic field can be described by a superposition of different spherical harmonics where each spherical harmonics has a normalization coefficient. For homogeneous magnetic fields, the spherical harmonics with small *n* and *m* order are dominant and highter order spherical harmonics can be neglected (their coefficients are close to zero).

Because the magnetic field is given by the gradient of the magnetic potential, the components of the magnetic field can be calculated by the derivative of the spherical harmonics.

For this package the spherical harmonics and their derivatives are implemented as ...

The background magnetic field is defined by the set of *a*<sub>*m* *n*</sub> coefficients which are non-zero.

## Coil Magnetic Field <a name="coil_field"></a>

The probe coil produces a magnetic field whenever an RF pulse is applied. The spatial shape of the coil's magnetic field only depends on the geometry of the coil itself and does not depend on the RF pulse (as long as the RF frequency is small enough that retardation effects are negligible).

The magnetic field of a current density can be calculated by the Biot-Savat law.
$$ Biot-Savat law $$
The Biot-Savat law includes an integral over the path of the current.
We parametrize the coil as an infinitisimal small wire with an helix shape. The coil is defined by its radius, number of turns and the length of the helix. We can now calculate the magnetic field at a specific point by numerical integration along the helix path.

An approximation allows us to get around the time consuming numerical integration. When we approximate one turn of the coil as a closed current loop, the magnetic field at a certain point can be calculated analytically using the form:
<img src="https://render.githubusercontent.com/render/math?math=\mathrm{some}\approx\mathrm{some other}">

The complete coil is then the superposition of several current loops. In this approximation it is easy to also include coils with multiple layers of windings as each current loop can be configured individually.

In the [section ...]() we investigate the limitations of the approximation and give advice in which case the numerical integration or the analytic formula should be used.

## Probe Sample <a name="probe"></a>

The probe sample is defined by its material and its shape and dimensions. We typically define a cylindrical probe sample which is defined by its diameter and length. We assume that the probe sample and the coil center align along the long axis.

The probe sample is an essential component of the simulation. We describe the probe sample in small finite volume elements called cells (by randomly picking places from the probe sample volume). Each cell sees a characteristic external magnetic field and a coil magnetic field. The external magnetic field defines the precession frequency of the probes material, while the coils magnetic field defines on the one hand how strong spins are rotated in case of an RF pulse and on the other hand how sensitive the pickup coil is to the precession signal of that cell.

## Materials and Properties <a name="materials"></a>

Materials are described by their density, molar mass, the longitudinal and transversal relaxation time and the gyromagnetic ratio.

We implemented petroleum jelly and water as materials. For water the temperature dependence of the gyromagnetic ratio is implemented as well.

## Pulsed NMR sequences <a name="sequence"></a>

Before going into the details we first like to introduce the general NMR pulse sequence and measurement principle.

In equilibrium, the spins within the sample are aligned with the external magnetic field.

## Bloch Equations <a name="bloch_eq"></a>

## RF Pulse <a name="rf_pulse"></a>

## Free Induction Decay <a name="FreeInductionDecay"></a>

## Spin Echo <a name="spin_echo"></a>

## Noise <a name="noise"></a>

## Signal Artefacts <a name="artefacts"></a>

* baseline
* distortions

[NMR_Probe_Sketch_Side]: plots/NMR_Probe_Sketch_Side.png "Sktech of NMR Probe, Sideview"
[NMR_Probe_Sketch_Head]: plots/NMR_Probe_Sketch_Head.png "Sktech of NMR Probe, Frontview"
